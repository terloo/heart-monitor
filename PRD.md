# 产品需求文档 (PRD)
## 智能手环心率监测APP

### 1. 产品概述

#### 1.1 产品名称
Heart Monitor - 智能心率监测应用

#### 1.2 产品定位
一款基于React Native Expo开发的移动应用，用于实时接收和显示智能手环通过蓝牙广播的心率数据，提供清晰直观的全屏显示模式。

#### 1.3 目标用户
- 健身爱好者
- 运动训练人员
- 需要实时监测心率的用户
- 智能手环用户

#### 1.4 平台
- **支持平台**：iOS和Android
- **最低系统要求**：
  - iOS：15.1+
  - Android：6.0 (API 23)+

---

### 2. 功能需求

#### 2.1 核心功能

##### 2.1.1 蓝牙心率数据接收
- **功能描述**：应用能够通过蓝牙BLE（低功耗蓝牙）接收智能手环广播的心率数据
- **技术要点**：
  - 使用BLE Heart Rate Service (UUID: 0x180D)
  - 监听Heart Rate Measurement特征值 (UUID: 0x2A37)
  - 支持自动重连机制
  - 权限请求：蓝牙权限、位置权限（Android）

##### 2.1.2 实时数据显示
- **功能描述**：在主界面实时显示接收到的心率数据
- **显示内容**：
  - 当前心率数值（BPM - 每分钟心跳次数）
  - 连接状态指示
  - 设备信息（可选）

##### 2.1.3 全屏显示模式
- **功能描述**：用户可以切换到全屏显示模式，专注查看心率数据
- **交互方式**：
  - 点击按钮进入全屏模式
  - 点击屏幕或返回按钮退出全屏模式
- **显示要求**：
  - 隐藏系统状态栏和导航栏
  - 屏幕常亮（防止锁屏）
  - 简洁的界面设计

#### 2.2 全屏模式详细设计

##### 2.2.1 心率数值显示
- **视觉设计**：
  - 大字号显示（建议80-120pt）
  - 居中对齐
  - 使用易读的无衬线字体
  - 高对比度配色
  - 显示单位"BPM"

##### 2.2.2 动态图标设计
- **功能描述**：根据心率区间变化颜色和动画效果的心形图标
- **心率区间定义**：
  1. **静息区** (<70 BPM)：绿色 (#10B981)
  2. **轻度运动区** (70-120 BPM)：蓝色 (#3B82F6)
  3. **中度运动区** (120-160 BPM)：黄色 (#F59E0B)
  4. **剧烈运动区** (160-180 BPM)：橙色 (#F97316)
  5. **极限区** (>180 BPM)：红色 (#EF4444)

- **动画效果**：
  - 心跳动画：图标按照当前心率节奏进行缩放动画
  - 动画频率：与实际心率同步
  - 平滑过渡：颜色变化时使用渐变过渡效果（300-500ms）

##### 2.2.3 布局设计
```
┌─────────────────────────┐
│                         │
│                         │
│       ❤ 动态图标         │
│     (根据心率变色)        │
│                         │
│                         │
│          120            │
│                         │
│                         │
└─────────────────────────┘
```

---

### 3. 非功能需求

#### 3.1 性能要求
- 数据刷新频率：至少1Hz（每秒更新一次）
- 蓝牙连接延迟：<2秒
- 界面响应时间：<100ms
- 动画流畅度：60fps

#### 3.2 兼容性要求
- iOS 15.1及以上
- Android 6.0 (API Level 23)及以上
- 支持蓝牙4.0 BLE及以上设备

#### 3.3 稳定性要求
- 蓝牙连接异常自动重连
- 数据异常过滤（过滤不合理的心率值，如<30或>220）
- 应用后台运行时保持蓝牙连接

#### 3.4 用户体验要求
- 清晰的连接状态提示
- 友好的错误提示信息
- 简洁直观的操作流程

---

### 4. 技术方案

#### 4.1 技术栈
- **框架**：React Native (Expo)
- **蓝牙库**：react-native-ble-plx
- **动画库**：React Native Animated API 或 Reanimated
- **状态管理**：React Hooks (useState, useEffect)

#### 4.2 关键技术点
1. BLE Heart Rate Service集成
2. 实时数据流处理
3. 动画性能优化
4. 屏幕常亮实现
5. 权限管理

---

### 5. 用户流程

#### 5.1 首次使用流程
1. 打开应用
2. 授予蓝牙和位置权限（Android）
3. 遍历所有已连接的蓝牙设备，筛选出支持心率广播的设备
4. 如果没有连接的设备，提示用户连接智能手环
5. 如果只有一个支持心率广播的设备，直接连接该设备
6. 如果有多个支持心率广播的设备，显示设备列表，用户选择并连接目标设备
7. 开始接收心率数据

#### 5.2 正常使用流程
1. 打开应用（自动连接上次设备）
2. 查看实时心率数据
3. 点击"全屏"按钮进入全屏模式
4. 观察心率数值和动态图标
5. 点击屏幕退出全屏模式

#### 5.3 切换设备流程
1. 点击"设备管理"按钮
2. 显示已连接设备列表并标记已连接的设备，筛选出支持心率广播的设备
3. 用户选择并连接新设备
4. 开始接收新设备的心率数据

#### 5.4 没有连接设备时的处理
- 显示"未连接"状态，提示用户连接智能手环
- 持续扫描蓝牙设备，筛选出支持心率广播的设备
- 如果找到新设备，直接连接该设备

---

### 6. 界面原型

#### 6.1 主界面
- 顶部：应用标题、连接状态
- 中部：当前心率数值、心形图标
- 底部：全屏按钮、设备管理按钮

#### 6.2 全屏界面
- 纯色背景（深色/浅色可配置）
- 中央：大号心率数值
- 心率数值上方：动态变色的心形图标
- 点击任意位置退出

---

### 7. 数据格式

#### 7.1 心率数据格式
根据蓝牙BLE Heart Rate Profile标准：
```javascript
{
  heartRate: 75,        // 心率值 (BPM)
  timestamp: Date.now(), // 时间戳
  deviceId: "xx:xx:xx:xx:xx:xx" // 设备MAC地址
}
```

---

### 8. 开发优先级

#### P0 - 核心功能（必须实现）
- [ ] 蓝牙BLE连接和数据接收
- [ ] 实时心率显示
- [ ] 全屏模式切换
- [ ] 心率数值显示

#### P1 - 重要功能
- [ ] 动态心形图标
- [ ] 心率区间颜色变化
- [ ] 心跳动画效果
- [ ] 屏幕常亮

#### P2 - 优化功能
- [ ] 设备管理界面
- [ ] 自动重连机制
- [ ] 数据历史记录
- [ ] 主题切换（深色/浅色）

---

### 9. 风险与挑战

#### 9.1 技术风险
- Expo对原生蓝牙API的支持限制（可能需要ejecting或使用开发版本）
- 不同品牌手环的蓝牙协议差异
- Android权限管理复杂性

#### 9.2 解决方案
- 优先使用Expo支持的蓝牙库，必要时使用Expo Dev Client
- 遵循标准BLE Heart Rate Profile，确保广泛兼容性
- 完善权限请求流程和用户引导

---

### 10. 后续迭代方向

#### 10.1 V1.0 (MVP)
- 基础心率接收和显示
- 全屏模式
- 简单的动态图标

#### 10.2 V1.1
- 心率历史数据记录
- 图表展示
- 数据导出功能

#### 10.3 V2.0
- 多设备支持
- 心率区间训练提醒
- 社交分享功能
- 数据统计分析

---

### 11. 验收标准

- [ ] 能够成功连接支持标准Heart Rate Profile的智能手环
- [ ] 心率数据更新频率≥1Hz
- [ ] 全屏模式下界面简洁，仅显示心率和图标
- [ ] 心形图标根据5个心率区间正确变色
- [ ] 心跳动画流畅，频率与心率同步
- [ ] 颜色过渡平滑自然
- [ ] 屏幕在全屏模式下保持常亮
- [ ] 应用稳定运行30分钟无崩溃

---

**文档版本**：V1.0
**创建日期**：2026-01-26
**负责人**：开发团队
**审核状态**：待审核
